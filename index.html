import os
import time
import json
import requests
from firebase_admin import credentials, db, initialize_app

# 1. إعدادات Firebase (ضع ملف الـ JSON الخاص بك هنا)
cred = credentials.Certificate("serviceAccountKey.json")
initialize_app(cred, {'databaseURL': 'https://realtime-database-df34b-default-rtdb.firebaseio.com/'})

def run_scanner(target_list):
    print("[+] Starting Automated Hunter...")
    # تشغيل nuclei على قائمة مواقع وحفظ النتائج في ملف json
    os.system(f"nuclei -list {target_list} -severity medium,high,critical -json -o results.json")
    
    if os.path.exists("results.json"):
        with open("results.json", "r") as f:
            for line in f:
                data = json.loads(line)
                # إرسال الثغرة المكتشفة إلى Firebase
                ref = db.reference('findings')
                ref.push({
                    'domain': data['host'],
                    'vuln_type': data['info']['name'],
                    'severity': data['info']['severity'],
                    'time': data['timestamp']
                })
        print("[!] New Vulnerabilities uploaded to your Dashboard!")

# ابدأ الفحص بضغطة زر
run_scanner("targets.txt")
